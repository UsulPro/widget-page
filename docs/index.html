<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <h2>SSIC Search Widget</h2>
    <div><span>Your User Name: </span> <span id="user-name"></span></div>
    <input type="text" name="search" id="search-input" />
    <button id="search-button">search</button>
  </body>
  <script>
    const sendToDataChannel = data => {
      window.parent.postMessage(
        {
          messageType: 'DATA',
          ...data,
        },
        '*'
      );
    };

    const sendToInitChannel = data => {
      window.parent.postMessage(
        {
          messageType: 'INIT',
          ...data,
        },
        '*'
      );
    };

    const searchButton = document.getElementById('search-button');
    const searchInput = document.getElementById('search-input');
    const userNameSpan = document.getElementById('user-name');

    searchButton.onclick = () =>
      sendToDataChannel({ searchString: 'cook thai food' });

    searchInput.onkeydown = ev => {
      sendToDataChannel({ searchString: ev.target.value });
    };

    const onDataChannel = data => {
      console.log('widget', data);
      // dataSpan.innerText = JSON.stringify(e.data);
    };

    const onInitChannel = data => {
      console.log('widget init channel', data);
      userNameSpan.innerText = data.userName;
      // widgetHolder.classList.add('enabled');
      // dataSpan.innerText = data.widgetName;
    };

    const onChannel = e => {
      const data = e.data;
      if (data.messageType === 'INIT') {
        onInitChannel(data);
      } else {
        onDataChannel(data);
      }
    };

    window.addEventListener('message', onChannel);

    window.onload = () => {
      console.log('widget is loaded!');
      sendToInitChannel({ widgetName: 'SSIC Search' });
    };
  </script>
</html>
